<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Low Latency Scheduling via Docker | 不为人知的幻想乡</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel="shortcut icon" href=/favicon.png type=image/x-icon><link rel=icon href=/favicon.png type=image/x-icon><link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:400,700&display=swap&subset=chinese-simplified" rel=stylesheet><link href=/font/FantasqueSansMono-Regular-decl.css rel=stylesheet></head><body><nav><ul class=menu></ul><hr></nav><div class=article-meta><h1><span class=title>Low Latency Scheduling via Docker</span></h1><h2 class=date>2018/06/28</h2></div><main><p><a href=/pdf/atc17-chen_wei.pdf>PDF</a>
<a href=/pdf/atc_slides_chen_wei_0.pdf>slide</a></p><h1 id=现象>现象</h1><ol><li>过长的作业占用了大量资源, 短作业没法调度</li><li>普遍实现是杀掉长作业空出资源</li><li>主流的框架不支持抢占</li></ol><table><thead><tr><th>框架</th><th>年份</th><th>做法</th><th>缺点</th></tr></thead><tbody><tr><td>YARN</td><td>13年</td><td>杀了长作业</td><td>overhead太大</td></tr><tr><td>Sparrow</td><td>13</td><td>per-task</td><td>没有作者想要的抢占</td></tr><tr><td>Hawk</td><td>15</td><td>保留一部分机器</td><td>很难预计保留多少</td></tr><tr><td>Natjam</td><td>13</td><td>checkpoint</td><td>存档的频率</td></tr><tr><td>Amoeba</td><td>12</td><td>checkpoint</td><td>存档的频率</td></tr><tr><td>CRIU</td><td>15</td><td>按序存档</td><td>入侵性太强</td></tr><tr><td>Borg</td><td>15</td><td>任务隔离</td><td>还是killbase</td></tr></tbody></table><p>kill-base 实现在 spark 中大概 80% 左右的overhead, mapreduce 中对于 map-heavy 是10% 对reduce-heavy 是50%.</p><p>map-heavy 的作业重启比较方便, 不会有多大的开销.</p><h1 id=做法>做法</h1><p>这玩意叫 Big-C</p><p>前提: 在 docker 中启动任务</p><h2 id=完全抢占-ip>完全抢占 (IP)</h2><ol><li>先把内存调64MB, 此时操作系统开始使用swap, 磁盘写入会上升</li><li>磁盘写入下降时把CPU限制到1%, 保证心跳</li></ol><h2 id=graceful-抢占-gp>Graceful 抢占 (GP)</h2><p>原理: CPU和内存需求成比例, 多申请的可以等会给. (文章中还列出了为什么普遍会多申请内存, 比如方式OOM)</p><ol><li>算出这台服务器上所有的容器多申请的资源</li><li>压缩</li><li>启动小任务</li></ol><h1 id=结果>结果</h1><p>比FIFO延迟小300%, 延迟约等于kill-base同时资源利用率在80%以上</p></main><footer><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

!function(e,n,t){for(var o,a,i,c,r,d="https://google-analytics.com/collect",s=n.hostname.split("."),l=e.cookie.match(/(^|; ?)_ga=GA1\.\d\.(\d+\.\d+)(;|$)/),h=l?l[2]:~~(2e9*Math.random())+"."+~~(Date.now()/1e3),g=s.length;g--&&(r="_ga=GA1."+(s.length-g)+"."+h,e.cookie=r+";max-age=63115200;domain="+s.slice(g).join("."),-1==e.cookie.split(/; ?/).indexOf(r)););track=((r,s,l,g,p)=>{if(o={v:1,tid:"UA-171813489-1",aip:1,cid:h,t:r,dr:e.referrer,dt:e.title,dl:n.href,ul:t.language.toLowerCase(),sr:screen.width+"x"+screen.height,vp:innerWidth+"x"+innerHeight},s&&(o.ec=s),l&&(o.ea=l),g&&(o.el=g),p&&(o.ev=p),t.sendBeacon)t.sendBeacon(d,new URLSearchParams(o));else{for(c in a=[],i=new XMLHttpRequest,o)a.push(k+"="+encodeURIComponent(o[c]));i.open("POST",d),i.send(a.join("&"))}}),track("pageview")}(document,location,navigator);
</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script></footer></body></html>